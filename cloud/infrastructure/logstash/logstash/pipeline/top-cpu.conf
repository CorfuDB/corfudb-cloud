# -----------------
# https://blogs.oracle.com/poonam/understanding-g1-gc-logs
# -----------------
input {
  stdin {
      codec => multiline {
        pattern => "^%{DAY}%{SPACE}%{MONTH}%{SPACE}%{MONTHDAY}%{SPACE}%{TIME}%{SPACE}(UTC)%{SPACE}%{YEAR}"
        negate => true
        what => "previous"
      }
    tags => [
      "top-cpu"
    ]
  }
}

filter {
    grok {
      patterns_dir => "/usr/share/logstash/patterns"
      match => {"message" => "%{GREEDYDATA:msg}"}
    }

    if "multiline" in [tags] {
       grok {
         patterns_dir => "/usr/share/logstash/patterns"
         match => {"msg" => "%{LOAD_AVERAGE}"}
       }
    }
}
