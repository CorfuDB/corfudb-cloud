import java.util.jar.JarEntry
import java.util.jar.JarFile
import org.apache.commons.io.IOUtils

buildscript {
    repositories {
        mavenCentral()
    }

    dependencies {
        classpath 'commons-io:commons-io:2.6'
    }
}

configurations {
    corfu
}

dependencies {
    corfu("org.corfudb:infrastructure:${corfuVersion}:shaded") {
        transitive = false
        exclude group: 'io.netty', module: 'netty-tcnative'
    }
}

processResources {
    /**
     * Download infrastructure jar
     */
    doLast {
        copy {
            duplicatesStrategy = DuplicatesStrategy.EXCLUDE
            from configurations.corfu
            into buildDir
        }
    }
}

task corfuInfo {
    dependsOn(processResources)

    doLast {
        JarFile file = new JarFile(new File("tests/build/infrastructure-0.3.0-SNAPSHOT-shaded.jar"))
        JarEntry entr


        y = file.getJarEntry("git.properties")
        InputStream entryStream = file.getInputStream(entry)
        String content = IOUtils.toString(entryStream)
        println(content)
    }
}